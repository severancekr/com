<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>í†µí•© ì—…ë¬´ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
  <style>
    :root { --primary-color: #006670; --secondary-color: #008489; --accent-color: #e6f7f8; --text-color: #2c3e50; --input-border: #cbd5e1; --white: #ffffff; --danger-color: #e74c3c; }
    
    body, html { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', sans-serif; background-image: url('https://ksnnews.or.kr/news/data/2025/03/11/p1065595035371594_319_thum.png'); background-size: cover; background-position: center; background-attachment: fixed; color: var(--text-color); display: flex; justify-content: center; align-items: center; }
    
    .app-container { width: 100%; max-width: 420px; height: 95vh; margin: 10px; background-color: rgba(255, 255, 255, 0.92); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-radius: 24px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2); overflow: hidden; display: flex; flex-direction: column; position: relative; border: 1px solid rgba(255,255,255,0.5); }
    
    .screen { display: none; width: 100%; height: 100%; overflow-y: auto; padding: 30px 25px; box-sizing: border-box; }
    .screen.active { display: block; animation: fadeSlideUp 0.4s ease-out; }
    @keyframes fadeSlideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    .logo-wrapper { width: 80px; height: 80px; margin: 0 auto 15px auto; background-color: var(--white); border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; border: 2px solid var(--accent-color); }
    .logo-wrapper img { width: 65%; height: auto; object-fit: contain; }

    .home-header { text-align: center; margin-bottom: 35px; margin-top: 10px; }
    .home-header h1 { color: var(--primary-color); font-size: 26px; font-weight: 800; margin: 0 0 8px 0; letter-spacing: -0.5px; }
    .home-header p { color: #64748b; font-size: 14px; margin: 0; font-weight: 500; }
    
    .menu-grid { display: flex; flex-direction: column; gap: 16px; }
    .menu-card { background: var(--white); border-left: 6px solid var(--secondary-color); border-radius: 16px; padding: 22px 20px; display: flex; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.04); cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); border-top: 1px solid #f1f5f9; border-right: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; }
    .menu-card:hover { transform: translateY(-4px); box-shadow: 0 12px 25px rgba(0, 102, 112, 0.15); border-left-color: var(--primary-color); }
    .menu-icon { font-size: 32px; margin-right: 18px; background: var(--accent-color); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
    .menu-text { text-align: left; }
    .menu-text h3 { margin: 0 0 4px 0; color: var(--text-color); font-size: 18px; font-weight: 700; }
    .menu-text p { margin: 0; color: #64748b; font-size: 13px; font-weight: 500; }

    .form-header h2 { color: var(--primary-color); margin: 0 0 25px 0; font-size: 22px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; }
    
    .form-group { margin-bottom: 22px; }
    label { display: block; margin-bottom: 8px; font-weight: 700; font-size: 14px; color: #334155; }
    .required::after { content: "*"; color: var(--danger-color); margin-left: 4px; }
    .time-flex { display: flex; align-items: center; gap: 10px; }
    input[type="text"], input[type="time"], select, textarea, input[type="file"] { width: 100%; padding: 14px; border: 1.5px solid var(--input-border); border-radius: 10px; box-sizing: border-box; font-size: 15px; font-family: inherit; background-color: #f8fafc; transition: all 0.2s; -webkit-appearance: none; color: #0f172a; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: var(--secondary-color); background-color: var(--white); box-shadow: 0 0 0 4px rgba(0, 132, 137, 0.1); }
    input[readonly] { background-color: #e2e8f0; color: #475569; font-weight: bold; border-color: #e2e8f0; cursor: not-allowed; } 
    textarea { resize: none; height: 110px; }
    
    /* í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .submit-btn { width: 100%; padding: 16px; background-color: var(--primary-color); color: var(--white); border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 5px; transition: 0.3s; box-shadow: 0 4px 12px rgba(0, 102, 112, 0.2); }
    .submit-btn:hover { background-color: #004d55; transform: translateY(-2px); }
    
    .home-return-btn { width: 100%; padding: 16px; background-color: var(--secondary-color); color: var(--white); border: none; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 5px; transition: 0.3s; box-shadow: 0 4px 12px rgba(0, 132, 137, 0.2); }
    .home-return-btn:hover { background-color: var(--primary-color); transform: translateY(-2px); }

    .undo-btn { width: 100%; padding: 14px; background-color: transparent; color: var(--danger-color); border: 2px solid var(--danger-color); border-radius: 12px; font-size: 15px; font-weight: 700; margin-top: 15px; cursor: pointer; transition: 0.2s; }
    .undo-btn:hover { background-color: #fef2f2; }
    
    .cancel-link { width: 100%; padding: 12px; background: none; border: none; color: #64748b; font-size: 14px; font-weight: 600; cursor: pointer; margin-top: 5px; text-decoration: underline; }

    .loading-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.85); backdrop-filter: blur(5px); z-index: 100; display: none; justify-content: center; align-items: center; flex-direction: column; }
    .spinner { border: 4px solid #e2e8f0; width: 45px; height: 45px; border-radius: 50%; border-left-color: var(--primary-color); animation: spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite; margin-bottom: 15px; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="loading-overlay" id="loadingOverlay"><div class="spinner"></div><p style="color: #006670; font-weight: 700;">ì•ˆì „í•˜ê²Œ ì „ì†¡ ì¤‘ì…ë‹ˆë‹¤...</p></div>

    <div id="homeScreen" class="screen active">
      <div class="home-header">
        <div class="logo-wrapper">
          <img src="https://s-tec.co.kr/images/icon/cyber_03_01.png" alt="ë¡œê³ ">
        </div>
        <h1>í†µí•© ì—…ë¬´ ì‹œìŠ¤í…œ</h1>
        <p>ì •í™•í•˜ê³  ì‹ ì†í•œ ìŠ¤ë§ˆíŠ¸ ë³´ê³  ì±„ë„</p>
      </div>
      
      <div class="menu-grid">
        <div class="menu-card" onclick="showScreen('form1Screen')">
          <div class="menu-icon">ğŸ“‹</div>
          <div class="menu-text"><h3>ìƒí™© ë³´ê³ </h3><p>í™˜ìë™í–‰, ë³‘ë™/ì™¸ë˜ ì‚¬ê³  ì§€ì›</p></div>
        </div>
        <div class="menu-card" onclick="showScreen('form2Screen')">
          <div class="menu-icon">ğŸ”¦</div>
          <div class="menu-text"><h3>ë¯¸ì‹œê±´ ë° ì†Œë“±</h3><p>ë¶€ì„œë³„ ì•¼ê°„ ë³´ì•ˆ/ì†Œë“± ì ê²€</p></div>
        </div>
        <div class="menu-card" onclick="showScreen('form3Screen')">
          <div class="menu-icon">ğŸ› ï¸</div>
          <div class="menu-text"><h3>ì‘ì—… í˜„í™©</h3><p>ì‹œì„¤ ì ê²€ ë° ê¸°íƒ€ ë¶€ì„œë³„ ì‘ì—…</p></div>
        </div>
      </div>
    </div>

    <div id="form1Screen" class="screen">
      <div class="form-header"><h2>ìƒí™© ë³´ê³  ì‘ì„±</h2></div>
      
      <form id="reportForm">
        <div class="form-group"><label>1. ë‚ ì§œ (ìë™ì…ë ¥)</label><input type="text" class="auto-date" readonly></div>
        
        <div class="form-group">
          <label class="required">2. ìœ í˜•</label>
          <select id="typeSelect" class="save-state" required>
            <option value="" disabled selected>ì„ íƒí•´ì£¼ì„¸ìš”</option>
            <option value="ì™¸ë˜">ì™¸ë˜</option><option value="ë³‘ë™">ë³‘ë™</option>
            <option value="ì™¸ë¶€">ì™¸ë¶€</option><option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
          </select>
          <input type="text" id="customType" class="save-state" placeholder="ìœ í˜• ì§ì ‘ ì…ë ¥" style="display:none; margin-top:8px;">
        </div>

        <div class="form-group">
          <label class="required">3. ì˜ˆë°©ë‚´ì—­</label>
          <select id="preventionSelect" class="save-state" required>
            <option value="" disabled selected>ì„ íƒí•´ì£¼ì„¸ìš”</option>
            <option value="í™˜ìë™í–‰">í™˜ìë™í–‰</option><option value="ìƒí™©ì¶œë™">ìƒí™©ì¶œë™</option>
            <option value="í™˜ìì´íƒˆ">í™˜ìì´íƒˆ</option><option value="ê³ ì¸ì´ì†¡">ê³ ì¸ì´ì†¡</option>
            <option value="ì±„í˜ˆì§€ì›">ì±„í˜ˆì§€ì›</option><option value="ì§ì ‘ì…ë ¥">ì§ì ‘ì…ë ¥</option>
          </select>
          <input type="text" id="customPrevention" class="save-state" placeholder="ì˜ˆë°©ë‚´ì—­ ì§ì ‘ ì…ë ¥" style="display:none; margin-top:8px;">
        </div>

        <div class="form-group"><label class="required">4. ê·¼ë¬´ì</label><input type="text" id="worker1" class="sync-worker save-state" placeholder="ì˜ˆ) í™ê¸¸ë™ ì™¸ 1ëª…" required></div>
        <div class="form-group"><label class="required">5. ì‚¬ê³ ì</label><input type="text" id="patientInput" class="save-state" placeholder="ì˜ˆ) ê¹€OO(69/ë‚¨)" required></div>
        <div class="form-group"><label class="required">6. ì¡°ì¹˜ê²°ê³¼</label><textarea id="resultInput" class="save-state" placeholder="ì¡°ì¹˜í•˜ì‹  ê²°ê³¼ë¥¼ ìƒì„¸íˆ ì ì–´ì£¼ì„¸ìš”." required></textarea></div>
        
        <div class="form-group">
          <label class="required">7. ì—…ë¬´ ì‹œê°„ (ì‹œì‘ ~ ì¢…ë£Œ)</label>
          <div class="time-flex">
            <input type="time" id="startTime1" class="save-state" required><span>~</span><input type="time" id="endTime1" class="save-state" required>
          </div>
        </div>

        <div class="form-group">
          <label>8. ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label>
          <input type="file" id="photo1" accept="image/*">
          <p style="font-size: 12px; color: #64748b; margin-top: 6px;">* ì‚¬ì§„ ì´¬ì˜ ì¤‘ í™”ë©´ì´ ë‹«í˜€ë„ ì‘ì„±í•˜ì‹  í…ìŠ¤íŠ¸ëŠ” ë³´ì¡´ë©ë‹ˆë‹¤.</p>
        </div>

        <div id="actionArea1">
          <button type="submit" class="submit-btn">ë³´ê³  ì œì¶œí•˜ê¸°</button>
          <button type="button" class="cancel-link" onclick="showScreen('homeScreen')">ì´ì „ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
        
        <div id="successArea1" style="display:none;">
          <button type="button" class="home-return-btn" onclick="goHomeAndReset(1)">ì²˜ìŒ ëŒì•„ê°€ê¸°</button>
          <button type="button" class="undo-btn" id="undoBtn1">ë°©ê¸ˆ ì œì¶œí•œ ë‚´ìš© ì‚­ì œ</button>
        </div>
      </form>
    </div>

    <div id="form2Screen" class="screen">
      <div class="form-header"><h2>ë¯¸ì‹œê±´ ë° ì†Œë“± ì ê²€</h2></div>
      
      <form id="form2">
        <div class="form-group"><label>1. ë‚ ì§œ (ìë™ì…ë ¥)</label><input type="text" class="auto-date" readonly></div>
        <div class="form-group"><label class="required">2. ê·¼ë¬´ì</label><input type="text" id="worker2" class="sync-worker save-state" placeholder="ê·¼ë¬´ì ì´ë¦„ ì…ë ¥" required></div>
        <div class="form-group"><label class="required">3. ì™¸ë˜ë¯¸ì‹œê±´ë¯¸ì†Œë“±</label><textarea id="content2" class="save-state" placeholder="ì˜ˆ) 5ì¸µ ê·¼ì „ë„ì‹¤ 1,2 ë¯¸ì‹œê±´" required></textarea></div>
        <div class="form-group"><label class="required">4. í™•ì¸ì‹œê°„</label><input type="time" id="checkTime2" class="save-state" required></div>
        <div class="form-group"><label>5. ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label><input type="file" id="photo2" accept="image/*"></div>
        
        <div id="actionArea2">
          <button type="submit" class="submit-btn">ì ê²€ ì œì¶œí•˜ê¸°</button>
          <button type="button" class="cancel-link" onclick="showScreen('homeScreen')">ì´ì „ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
        <div id="successArea2" style="display:none;">
          <button type="button" class="home-return-btn" onclick="goHomeAndReset(2)">ì²˜ìŒ ëŒì•„ê°€ê¸°</button>
          <button type="button" class="undo-btn" id="undoBtn2">ë°©ê¸ˆ ì œì¶œí•œ ë‚´ìš© ì‚­ì œ</button>
        </div>
      </form>
    </div>

    <div id="form3Screen" class="screen">
      <div class="form-header"><h2>ì‘ì—… í˜„í™© ë³´ê³ </h2></div>
      
      <form id="form3">
        <div class="form-group"><label>1. ë‚ ì§œ (ìë™ì…ë ¥)</label><input type="text" class="auto-date" readonly></div>
        <div class="form-group"><label class="required">2. ê·¼ë¬´ì</label><input type="text" id="worker3" class="sync-worker save-state" placeholder="ê·¼ë¬´ì ì´ë¦„ ì…ë ¥" required></div>
        <div class="form-group"><label class="required">3. ë¶€ì„œì‘ì—…í˜„í™©</label><textarea id="content3" class="save-state" placeholder="ì‘ì—…í•˜ì‹  ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." required></textarea></div>
        <div class="form-group"><label class="required">4. í™•ì¸ì‹œê°„</label><input type="time" id="checkTime3" class="save-state" required></div>
        <div class="form-group"><label>5. ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label><input type="file" id="photo3" accept="image/*"></div>
        
        <div id="actionArea3">
          <button type="submit" class="submit-btn">í˜„í™© ì œì¶œí•˜ê¸°</button>
          <button type="button" class="cancel-link" onclick="showScreen('homeScreen')">ì´ì „ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
        <div id="successArea3" style="display:none;">
          <button type="button" class="home-return-btn" onclick="goHomeAndReset(3)">ì²˜ìŒ ëŒì•„ê°€ê¸°</button>
          <button type="button" class="undo-btn" id="undoBtn3">ë°©ê¸ˆ ì œì¶œí•œ ë‚´ìš© ì‚­ì œ</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // â˜… ì‹¤ì¥ë‹˜ì˜ ìŠ¤í¬ë¦½íŠ¸ ê³ ì • URL
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxK9_OtEHMpThIjXP6bUwi5j_cEMoFN9tDsd69qavXceqnq8fxWzJruMYpreuk8dUMS7A/exec';
    
    let lastUuid1 = null; let lastUuid2 = null; let lastUuid3 = null;

    function getFormattedDate() {
      const now = new Date(); 
      return `${String(now.getMonth()+1).padStart(2,'0')}/${String(now.getDate()).padStart(2,'0')}(${['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][now.getDay()]})`;
    }
    function formatTime(d) { return String(d.getHours()).padStart(2, '0') + ':' + String(d.getMinutes()).padStart(2, '0'); }
    function getCurrentTime() { return formatTime(new Date()); }
    function getEndTime() { const d = new Date(); d.setMinutes(d.getMinutes() + 15); return formatTime(d); }

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
    }

    // ì œì¶œ í›„ ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ë©´ì„œ ë²„íŠ¼ ì›ìƒë³µêµ¬
    function goHomeAndReset(formNum) {
      document.getElementById('actionArea' + formNum).style.display = 'block';
      document.getElementById('successArea' + formNum).style.display = 'none';
      showScreen('homeScreen');
    }

    // â˜… ì¹´ë©”ë¼ íŠ•ê¹€ ì™„ë²½ ëŒ€ë¹„: ëª¨ë“  ì…ë ¥ì°½ ì„ì‹œì €ì¥ ë¡œì§ (ê°•í™”ë¨)
    window.addEventListener('load', () => {
      document.querySelectorAll('.auto-date').forEach(el => el.value = getFormattedDate());
      
      // ì €ì¥ëœ ë°ì´í„° ë³µì›
      document.querySelectorAll('.save-state').forEach(el => {
        const savedVal = localStorage.getItem('as_' + el.id);
        if(savedVal) {
          el.value = savedVal;
          if(el.tagName === 'SELECT') el.dispatchEvent(new Event('change')); // ë“œë¡­ë‹¤ìš´ ìƒíƒœ ë³µì›
        }
        // ê¸€ìë¥¼ ì¹  ë•Œë§ˆë‹¤ ì¦‰ì‹œ ì €ì¥
        el.addEventListener('input', () => localStorage.setItem('as_' + el.id, el.value));
        el.addEventListener('change', () => localStorage.setItem('as_' + el.id, el.value));
      });

      // ë§Œì•½ ì‹œê°„ ë°ì´í„°ê°€ ì €ì¥ ì•ˆë˜ì–´ìˆë‹¤ë©´ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì„¸íŒ…
      if(!document.getElementById('startTime1').value) document.getElementById('startTime1').value = getCurrentTime();
      if(!document.getElementById('endTime1').value) document.getElementById('endTime1').value = getEndTime();
      if(!document.getElementById('checkTime2').value) document.getElementById('checkTime2').value = getCurrentTime();
      if(!document.getElementById('checkTime3').value) document.getElementById('checkTime3').value = getCurrentTime();
    });

    // ê·¼ë¬´ì ì´ë¦„ ë™ê¸°í™” (íŠ¹ìˆ˜ì²˜ë¦¬)
    document.querySelectorAll('.sync-worker').forEach(input => {
      input.addEventListener('input', function() {
        document.querySelectorAll('.sync-worker').forEach(el => {
          el.value = this.value;
          localStorage.setItem('as_' + el.id, this.value);
        });
      });
    });

    function handleDirectInput(selectId, inputId) {
      document.getElementById(selectId).addEventListener('change', function() {
        const input = document.getElementById(inputId);
        if(this.value === 'ì§ì ‘ì…ë ¥') { input.style.display = 'block'; input.required = true; } 
        else { input.style.display = 'none'; input.required = false; input.value = ''; localStorage.removeItem('as_' + inputId); }
      });
    }
    handleDirectInput('typeSelect', 'customType');
    handleDirectInput('preventionSelect', 'customPrevention');

    // ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ ì™„ë£Œ í›„ ì„ì‹œì €ì¥ ë¹„ìš°ê¸° (ê·¼ë¬´ì ì´ë¦„ ì œì™¸)
    function clearAutoSave() {
      document.querySelectorAll('.save-state').forEach(el => {
        if(!el.id.includes('worker')) {
          localStorage.removeItem('as_' + el.id);
        }
      });
    }

    async function submitForm(sheetName, dataObj, photoInputId, formNum) {
      document.getElementById('loadingOverlay').style.display = 'flex';
      const fileInput = document.getElementById(photoInputId);
      
      const handleFile = () => new Promise((resolve) => {
        const file = fileInput.files[0];
        if (!file) { resolve(); return; }
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement('canvas');
            let w = img.width, h = img.height;
            if (w > 1024) { h = Math.round(h * 1024 / w); w = 1024; }
            canvas.width = w; canvas.height = h;
            canvas.getContext('2d').drawImage(img, 0, 0, w, h);
            dataObj.fileData = canvas.toDataURL('image/jpeg', 0.8);
            dataObj.fileName = file.name; resolve();
          }; img.src = e.target.result;
        }; reader.readAsDataURL(file);
      });

      try {
        await handleFile();
        await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(dataObj) });
        alert(sheetName + ' ë“±ë¡ ì™„ë£Œ!');
        
        // ì œì¶œ ì„±ê³µ ì‹œ ë²„íŠ¼ ì˜ì—­ êµì²´ (ì œì¶œë²„íŠ¼ ìˆ¨ê¸°ê³  'ì²˜ìŒ ëŒì•„ê°€ê¸°' í‘œì‹œ)
        document.getElementById('actionArea' + formNum).style.display = 'none';
        document.getElementById('successArea' + formNum).style.display = 'block';
        clearAutoSave();
        return true;
      } catch (error) { alert('ì „ì†¡ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); return false; } 
      finally { document.getElementById('loadingOverlay').style.display = 'none'; }
    }

    document.getElementById('reportForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      let type = document.getElementById('typeSelect').value; if (type === 'ì§ì ‘ì…ë ¥') type = document.getElementById('customType').value;
      let prev = document.getElementById('preventionSelect').value; if (prev === 'ì§ì ‘ì…ë ¥') prev = document.getElementById('customPrevention').value;

      lastUuid1 = Date.now().toString(36);
      const data = {
        action: 'insert', sheetName: 'ìƒí™©ë³´ê³ ', uuid: lastUuid1,
        date: document.querySelectorAll('.auto-date')[0].value,
        type: type, prevention: prev,
        worker: document.getElementById('worker1').value,
        patient: document.getElementById('patientInput').value,
        resultText: document.getElementById('resultInput').value,
        timeRange: `${document.getElementById('startTime1').value}~${document.getElementById('endTime1').value}`
      };

      if(await submitForm('ìƒí™©ë³´ê³ ', data, 'photo1', 1)) {
        this.reset();
        document.querySelectorAll('.auto-date')[0].value = getFormattedDate();
        document.getElementById('startTime1').value = getCurrentTime(); document.getElementById('endTime1').value = getEndTime();
        document.getElementById('worker1').value = localStorage.getItem('as_worker1') || '';
        document.getElementById('customType').style.display = 'none'; document.getElementById('customPrevention').style.display = 'none';
      }
    });

    document.getElementById('form2').addEventListener('submit', async function(e) {
      e.preventDefault(); lastUuid2 = Date.now().toString(36);
      const data = {
        action: 'insert', sheetName: 'ë¯¸ì‹œê±´ë°ì†Œë“±', uuid: lastUuid2,
        date: document.querySelectorAll('.auto-date')[1].value,
        worker: document.getElementById('worker2').value,
        content: document.getElementById('content2').value,
        checkTime: document.getElementById('checkTime2').value
      };
      if(await submitForm('ë¯¸ì‹œê±´ë°ì†Œë“±', data, 'photo2', 2)) {
        this.reset();
        document.querySelectorAll('.auto-date')[1].value = getFormattedDate();
        document.getElementById('checkTime2').value = getCurrentTime();
        document.getElementById('worker2').value = localStorage.getItem('as_worker2') || '';
      }
    });

    document.getElementById('form3').addEventListener('submit', async function(e) {
      e.preventDefault(); lastUuid3 = Date.now().toString(36);
      const data = {
        action: 'insert', sheetName: 'ì‘ì—…í˜„í™©', uuid: lastUuid3,
        date: document.querySelectorAll('.auto-date')[2].value,
        worker: document.getElementById('worker3').value,
        content: document.getElementById('content3').value,
        checkTime: document.getElementById('checkTime3').value
      };
      if(await submitForm('ì‘ì—…í˜„í™©', data, 'photo3', 3)) {
        this.reset();
        document.querySelectorAll('.auto-date')[2].value = getFormattedDate();
        document.getElementById('checkTime3').value = getCurrentTime();
        document.getElementById('worker3').value = localStorage.getItem('as_worker3') || '';
      }
    });

    async function handleUndo(sheetName, uuid, formNum) {
      if(!confirm('ë°©ê¸ˆ ì œì¶œí•œ ë‚´ìš©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      document.getElementById('loadingOverlay').style.display = 'flex';
      try {
        await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'delete', sheetName: sheetName, uuid: uuid }) });
        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'); 
        // ì‚­ì œ ì„±ê³µ ì‹œ ë‹¤ì‹œ ì“¸ ìˆ˜ ìˆê²Œ ì›ë˜ ë²„íŠ¼ìœ¼ë¡œ ë³µêµ¬
        document.getElementById('actionArea' + formNum).style.display = 'block';
        document.getElementById('successArea' + formNum).style.display = 'none';
      } catch(e) { alert('ì˜¤ë¥˜ ë°œìƒ'); } finally { document.getElementById('loadingOverlay').style.display = 'none'; }
    }
    
    document.getElementById('undoBtn1').addEventListener('click', () => handleUndo('ìƒí™©ë³´ê³ ', lastUuid1, 1));
    document.getElementById('undoBtn2').addEventListener('click', () => handleUndo('ë¯¸ì‹œê±´ë°ì†Œë“±', lastUuid2, 2));
    document.getElementById('undoBtn3').addEventListener('click', () => handleUndo('ì‘ì—…í˜„í™©', lastUuid3, 3));
  </script>
</body>
</html>
